# AGENTS.md для проекта TiktokAutoUploader

Данный файл содержит рекомендации для OpenAI Codex (или других AI-агентов), работающих с проектом автоматической обработки и загрузки видео в TikTok. Здесь описана структура проекта, ответственность модулей, конвенции по стилю и правила работы с кодовой базой.

---

## 1. Обзор проекта

**Название:** TiktokAutoUploader  
**Описание:**  
Универсальное десктопное приложение на Python, предназначенное для пакетной подготовки, редактирования и загрузки вертикальных видео в TikTok. Поддерживает многопоточную работу с несколькими аккаунтами, планирование публикаций, автоматическую загрузку клипов с Twitch, базовое редактирование видео (обрезка, поворот, водяной знак), и гибкий GUI на основе Material Design 3.

**Основные функции (для навигации Codex):**  
- Упрощённый CLI и Drag'n'drop GUI (объединены в `main.py`)  
- Видеообработка через `ffmpeg-python`  
- Twitch-интеграция (загрузка вертикальных клипов)  
- Пакетная генерация и публикация видео  
- Управление пулом TikTok-аккаунтов, автоматическая смена пароля  
- Планирование публикаций  
- Перетаскиваемый водяной знак и интерфейс WYSIWYG  

---

## 2. Структура репозитория
```
/
├── .deepsource.toml                     – конфигурация анализатора кода DeepSource  
├── .env                                – параметры окружения (URL входа, каталоги и др.)  
├── .gitignore                          – исключаемые файлы/директории (cookie, видео, node_modules…)  
├── .github/
│   └── FUNDING.yml                     – ссылки на спонсорство GitHub  
├── Common Problems Help Readme.md      – памятка с частыми проблемами и их решениями  
├── LICENSE                             – лицензия проекта  
├── README.md                           – описание возможностей и инструкция по установке  
├── TiktokUploader v2 Class Diagram.pdf – диаграмма классов  
├── TiktokUploader v2 Sequence Diagram.pdf – диаграмма последовательностей  
├── changes.txt                         – журнал изменений ранних версий  
├── config.txt                          – основной файл настроек (пути к каталогам, параметры ImageMagick и др.)  
├── requirements.txt                    – зависимости Python (requests, moviepy, PyQt5…)  
├── setup.py                            – метаданные пакета для установки через `pip`  
├── cli.py                              – консольный интерфейс: логин, загрузка видео, просмотр файлов  
├── main.py                             – единая точка входа; выбирает CLI или GUI по флагу `--gui`  
├── youtube_downloader.py               – скрипт сбора и скачивания YouTube Shorts  
├── CookiesDir/                         – каталог для сохранения cookies (в репозитории пример `empty.cookie`)  
├── VideosDirPath/                      – каталог с исходными/обработанными видео (`pre-processed.mp4` как пример)  
├── tiktok_uploader/                    – основной пакет приложения  
│   ├── __init__.py                     – экспорты: `Config`, `Video`, `login`, `upload_video`, функции управления cookies  
│   ├── gui_app.py                      – графический интерфейс на PyQt5  
│   ├── config/
│   │   └── settings.py                 – класс `Config`, загрузка настроек из файла/переменных окружения  
│   ├── core/
│   │   ├── browser.py                  – синглтон `Browser` на `undetected_chromedriver` для авторизации  
│   │   └── video.py                    – класс `Video` (скачивание с YouTube, кадрирование, наложение текста)  
│   ├── upload/
│   │   └── uploader.py                 – логика входа и отправки видео через HTTP‑API TikTok  
│   ├── utils/
│   │   ├── basics.py                   – вспомогательная функция `eprint`  
│   │   ├── bot_utils.py                – генерация подписи запросов, CRC32, обработка хэштегов/упоминаний  
│   │   └── cookies.py                  – чтение, запись и очистка файлов cookie  
│   └── tiktok-signature/               – NodeJS-скрипты для вычисления подписи (`browser.js`, `index.js`, `utils.js`, `javascript/*`)  
├── tests/                              – модульные тесты  
│   ├── test_cookies.py                 – проверка сохранения/загрузки cookie  
│   ├── test_errors.py                  – проверка выводов `assert_success`  
│   └── test_upload.py                  – тесты валидации параметров `upload_video`  
└── (прочие служебные каталоги Git)

```
---

## 3. Основные модули и назначение

- main.py — точка входа, переключает CLI/GUI, обрабатывает конфиг
- cli.py — запуск обработки/загрузки видео из консоли
- gui_app.py — интерфейс на PyQt5, drag’n’drop, Material Design 3
- youtube_downloader.py — загрузка Shorts (прототип)
- config.txt — текстовая конфигурация проекта (пути, ffmpeg, watermark)
- tiktok_uploader.config.settings — загрузка конфигурации в Python
- tiktok_uploader.core.video — обрезка, поворот, кадрирование видео
- tiktok_uploader.upload.uploader — логика авторизации и загрузки видео
- tiktok_uploader.utils.cookies — работа с cookie-файлами
- tiktok_uploader.utils.bot_utils — генерация подписи, утилиты
- tiktok_uploader.tiktok-signature — NodeJS скрипты подписи (обязательно)
- tests/ — unit-тесты загрузки, куки и ошибок

---

## 4. Конвенции и стиль

- Язык: Python 3, PEP 8  
- Комментарии в коде запрещены  
- Все названия должны быть самодокументируемыми  
- Разрешены docstring только для нестандартных алгоритмов  
- Ошибки логируются через `logging`  
- Все пути в конфиге — относительные  
- Drag’n’drop применяется для видео, вотермарки, обрезки  
- Все API-вызовы TikTok/Twitch — асинхронные  
- Иконки в GUI — обязательны, загружаются динамически  
- Пароли аккаунтов TikTok обновляются после каждой загрузки и сохраняются  
- Поддержка конфигурации из `config.txt`, `.env`, и `settings.py`

---

## 5. Именование задач

- feature <название_на_английском>
- bugfix - краткое описание на русском или английском
- refactor - краткое описание
- docs - обновление документации

Примеры:
- feature twitch_downloader  
- bugfix - ошибка QFontDatabase  
- refactor - вынос загрузки в отдельный поток  
- docs - обновление AGENTS.md  

---

## 6. Версионирование коммитов

Формат: #XX.YY.Z  
- XX — основная версия (архитектура)  
- YY — крупное добавление  
- Z — мелкий фикс или баг  

Примеры:
- #23.0 — текущая версия (архитектура объединения GUI+CLI)  
- #23.1 — добавление Twitch-скачиваний  
- #23.1.1 — багфикс водяного знака  

---

## 7. Особые правила

- Не оставляй комментариев в коде  
- Используй строгую структуру функций  
- Все вводы/выводы видео должны проходить через editor (ffmpeg)  
- Не пиши UI вручную — используй Qt Designer или PyQt шаблоны  
- Учетные записи должны обрабатываться пакетно — список аккаунтов, смена пароля, логирование  
- Не используй устаревшие библиотеки (pkg_resources, urllib.request и пр.)

---

## 8. Последний номер обновления

#23.0

---

Конец AGENTS.md
